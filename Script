-- Connections & Threads
local Connections = {}
local Threads = {}

-- Script function
local scriptON = false
function StartLoop()
-- Main vars
local nottp = false
local alrend = false
local detector = Instance.new("Part", game.Workspace)
detector.Anchored = true
detector.CanCollide = false
detector.Size = Vector3.new(1, 1, 1)
detector.Position = Vector3.new(0, 5, 0)

local TPSPEED = 2000
local TPRarity = "Celestial"

local alr = false
local Visited = {}
local bPointer = nil
local p = game.Players.LocalPlayer
local c = p.Character
local hrp = c:WaitForChild("HumanoidRootPart")
local ts = game:GetService("TweenService")
local ppservice = game:GetService("ProximityPromptService")
local pathY = 75
local pathZ = 132.7
local rs = game:GetService("RunService")
local tend = Vector3.new(4028.2, 1, 128.9)

-- Teleporter function
function tp(pos)
    if not scriptON then return end
    if not nottp then
    nottp = true
    if (pos - hrp.Position).Magnitude < 320 then
        hrp.CFrame = CFrame.new(pos)
    else
        local twfly = ts:Create(hrp, TweenInfo.new((pos - hrp.Position).Magnitude / TPSPEED, Enum.EasingStyle.Linear, Enum.EasingDirection.Out, 0, false, 0), {CFrame = CFrame.new(pos)})
        twfly:Play()
        twfly.Completed:Wait()
    end
    hrp.AssemblyLinearVelocity = Vector3.zero
    hrp.AssemblyAngularVelocity = Vector3.zero
    nottp = false
    end
end

-- Update HumanoidRootPart
Connections.A = p.CharacterAdded:Connect(function(Character)
    c = Character
    hrp = c:WaitForChild("HumanoidRootPart")
end)

-- Goto home
Connections.B = ppservice.PromptTriggered:Connect(function(prompt)
    if not scriptON then return end
    alrend = false
    if prompt:IsDescendantOf(game.Workspace.ActiveBrainrots) or prompt:IsDescendantOf(game.Workspace.ActiveLuckyBlocks) then
        tp(Vector3.new(hrp.Position.X, pathY, pathZ))
        tp(Vector3.new(60, pathY, pathZ))
        alr = false
        tp(detector.Position)
    end
end)

-- Instantpp & Brainrot pointer
Connections.C = game.DescendantAdded:Connect(function(d)
    if not scriptON then return end
    if d:IsA("ProximityPrompt") and d:IsDescendantOf(game.Workspace.ActiveBrainrots) then
        d.HoldDuration = 0
    elseif d:IsA("BasePart") then
        d.CanQuery = true
    end
end)

-- Update instantpp & Break security
for _, d in ipairs(game:GetDescendants()) do
    if d:IsA("ProximityPrompt") and d:IsDescendantOf(game.Workspace.ActiveBrainrots) then
        d.HoldDuration = 0
    elseif d:IsA("BasePart") then
        d.CanQuery = true
    end
end

-- Auto steal
Connections.D = rs.Heartbeat:Connect(function()
    if not scriptON then return end
    for _, d in ipairs(game.Workspace.ActiveBrainrots:GetDescendants()) do
        if d:IsA("ProximityPrompt") then
            if (d.Parent.Position - hrp.Position).Magnitude < 50 then
                d:InputHoldBegin()
                task.wait(0.1)
                d:InputHoldEnd()
            end
        end
    end
end)

-- Goto end
Connections.E = detector.Touched:Connect(function(hit)
    if not scriptON then return end
    if hit == hrp then
        tp(Vector3.new(120, pathY, pathZ))
        tp(Vector3.new(4150, pathY, pathZ))
        task.wait(0.5)
        tp(tend)
        task.wait(0.2)
        hrp.Anchored = true
        alrend = true
        for _, d in ipairs(game.Workspace.ActiveBrainrots.Celestial:GetDescendants()) do
            if d:IsA("ProximityPrompt") then
                hrp.Anchored = false
                tp(d.Parent.Position)
                task.wait(0.2)
            end
        end
        local actlb = game.Workspace.ActiveLuckyBlocks
        if actlb then local nslbc = actlb:FindFirstChild("NaturalSpawnLuckyBlock_Celestial") end
        if nslbc then
        for _, d in ipairs(nslbc:GetDescendants()) do
              if d:IsA("ProximityPrompt") then
                hrp.Anchored = false
                tp(d.Parent.Position)
            end
        end
        end
    end
end)

-- Find Celestial
Connections.F = rs.Heartbeat:Connect(function()
    if not scriptON then return end
    local celestialsF = game.Workspace.ActiveBrainrots[TPRarity]
    for _, m in ipairs(celestialsF:GetChildren()) do
        if m.Name == "RenderedBrainrot" then
            local q = m:GetChildren()
            if #q > 0 then
                bPointer = q[1]
            end
        end
    end
end)

-- Teleport to Celestial
Connections.G = rs.Heartbeat:Connect(function()
    if not scriptON then return end
    if bPointer and alrend then
        if (bPointer.Position - hrp.Position).Magnitude < 500 then
            if not table.find(Visited, bPointer) then
              local brainrotName
              if bPointer:FindFirstAncestor("RenderedBrainrot") then
                  brainrotName = bPointer.Name
              end
              print("[Find Brainrot] " .. brainrotName)
              tp(Vector3.new(bPointer.Position.X, hrp.Position.Y, pathZ))
              task.wait(0.42)
              tp(bPointer.Position)
              table.insert(Visited, bPointer)
              hrp.Anchored = true
              local bPPP = nil
              for  _, d in ipairs(bPointer:GetChildren()) do
                  if d:IsA("ProximityPrompt") then
                      bPPP = d
                  end
              end
              task.wait(0.3)
              bPPP:InputHoldBegin()
              task.wait(0.1)
        bPPP:InputHoldEnd()
              hrp.Anchored = false
              print("[Find Brainrot] Success!")
            end
        end
    end
end)
tp(detector.Position)
end

-- Main vars 2
local plr = game.Players.LocalPlayer
local chr = plr.Character or plr.CharacterAdded:Wait()
local hmn = chr.Humanoid or chr:WaitForChild("Humanoid")
local hrp = chr.HumanoidRootPart or chr:WaitForChild("HumanoidRootPart")

-- Update
plr.CharacterAdded:Connect(function(c)
    chr = c
    hrp = c:WaitForChild("HumanoidRootPart")
    hmn = c:WaitForChild("Humanoid")
end)

-- Load script
plr.CharacterAdded:Connect(function()
    if scriptON then
        StartLoop()
    end
end)

-- Kill function
function killPlr()
    pcall(function() hmn:TakeDamage(hmn.Health) end)
end

-- Script GUI
local ScreenGui = Instance.new("ScreenGui", plr:WaitForChild("PlayerGui"))
ScreenGui.Name = "TsuvayzoGui"
ScreenGui.ResetOnSpawn = false

local Bt1 = Instance.new("TextButton", ScreenGui)
Bt1.Name = "Btn1"
Bt1.TextScaled = true
Bt1.Text = "AUTO CELESTIAL"
Bt1.TextColor3 = Color3.fromRGB(255, 255, 255)
Bt1.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Bt1.Size = UDim2.new(0, 150, 0, 45)
Bt1.Position = UDim2.new(0, 10, 0, 10)

local uc1 = Instance.new("UICorner", Bt1)
uc1.Name = "UICRN"
uc1.CornerRadius = UDim.new(0, 12)

-- Toggle status
Bt1.MouseButton1Click:Connect(function()
    hrp.Anchored = false
    scriptON = not scriptON
    local greenC3 = Color3.fromRGB(0, 255, 0)
    local redC3 = Color3.fromRGB(255, 0, 0)
    if not scriptON then Bt1.BackgroundColor3 = redC3 else Bt1.BackgroundColor3 = greenC3 end
    killPlr()

    -- AntiLag
    if not scriptON then
        for _, c in pairs(Connections) do
            if c then c:Disconnect() end
        end
        for _, t in pairs(Threads) do
            if t then task.cancel(t) end
        end
    end
end)
